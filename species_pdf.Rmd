---
date: "Fecha de creación: `r format(Sys.time(), '%d %B, %Y')`"
always_allow_html: true
output:
  pdf_document: 
    toc: false
    toc_depth: 1
  html_document:
    df_print: paged
  word_document: default
header-includes:
  \usepackage{titling}
  \pretitle{\begin{center}
  \vspace{-2cm}\includegraphics[width=\linewidth,height=0.7in]{images/Base_info/logo.png}\LARGE\\}
  \posttitle{\end{center}}
  \usepackage{float}
  \usepackage{fancyhdr}
  \usepackage{ragged2e}
  \usepackage{caption}
  \captionsetup[figure]{labelformat=empty}
  \pagestyle{fancy}
  \fancyhead[L,C]{}
  \fancypagestyle{plain}{\pagestyle{fancy}}
params:
  species: 'Blastocerus dichotomus'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, include = FALSE)
library(rvest)
library(tidyverse)
library(kableExtra)
source('R/funcs.R', local = knitr::knit_global())
```

```{r dataload}
db <- read_csv('data/especies_nativas.csv')

db.sp <- db %>% filter(title == params$species)
cat.logo <- db.sp$sp_cat_nac_conserv_2019 %>% 
  str_split(' ', simplify = TRUE) %>% .[1] %>% tolower()
cat.logo <- paste0('images/scale-', cat.logo, '.png')


doi <- 'doi:https://d.1025CMAoideprueba'
```

---
title: "*`r db.sp$title`*"
subtitle: "**`r db.sp$sp_nombre_comun`**"   
---

\fancyhead[R]{\textbf{`r doi`}}

\center

## **Autores: `r db.sp$sp_autores_de_ficha`**

```{r catlogo, fig.pos='H', echo=FALSE, include=TRUE, fig.align='center', out.width='70%'}
knitr::include_graphics(cat.logo)
knitr::include_graphics('images/cma-logo.png')
# knitr::include_graphics(paste0('photos/', params$species, '.png'))
```

***

\justifying

**Citar como:** `r db.sp$sp_autores_de_ficha`. (2019). *`r db.sp$title`*. En: SAyDS--SAREM (eds.) Categorización 2019 de los mamíferos de Argentina según su riesgo de extinción. Lista Roja de los mamíferos de Argentina. Versión digital: <http://cma.sarem.org.ar>.

***

\newpage

```{r image, fig.pos='H', echo=FALSE, include=TRUE, fig.align='center', out.width='50%', fig.cap= paste0("Fotos por ", "Salvador Dali")}
 knitr::include_graphics(paste0('photos/', db.sp$title, '.png'))
 # knitr::opts_chunk$set(fig.cap = "Fotos por Dali")
```

**Categoría Nacional de Conservación 2019**

`r db.sp$sp_cat_nac_conserv_2019`

**Criterios y subcriterios**

`r db.sp$sp_cat_nac_conserv_2019_criterio`

**Justificación de la categorización**

`r db.sp$sp_cat_nac_conserv_2019_justific`

**Evaluación de subpoblaciones locales**

```{r tabla-subpoblaciones,echo=FALSE, include=TRUE, results='asis'}

spListPop <- db.sp$group_sp_eval_subpob %>% str_split('\n') %>% unlist() %>% str_trim()

spListPop <- spListPop[ spListPop != ""]

subPob <- spListPop[which(str_detect(spListPop, 'Subpoblación')) + 1]
catPob <- spListPop[which(str_detect(spListPop, 'Subpoblación')) + 3]
criPob <- spListPop[which(str_detect(spListPop, 'Subpoblación')) + 5]

tbsPob <- vector()
for(i in seq_along(subPob)){
tbsPob[i] <- tribble(
 ~'Subpoblación', ~'Categoría', ~'Criterios y subcriterios',
  subPob[i], catPob[i], criPob[i]
) %>% kbl(booktabs = T, format = 'latex') %>% row_spec(0,bold=TRUE) %>% 
  kable_styling(latex_options = c('striped', "HOLD_position"),
                position = "center", full_width = T)
}

p_str <- paste0(tbsPob, collapse = '\\vspace{0.3cm}')

cat(p_str)
```


